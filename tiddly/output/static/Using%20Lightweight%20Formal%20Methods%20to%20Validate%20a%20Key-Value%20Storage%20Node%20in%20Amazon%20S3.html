<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="generator" content="TiddlyWiki" />
<meta name="tiddlywiki-version" content="5.3.3" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no">
<link id="faviconLink" rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="static.css">
<title>Using Lightweight Formal Methods to Validate a Key-Value Storage Node in Amazon S3: ya0guang's notebook — Personality Backup</title>
</head>
<body class="tc-body">

<section class="tc-story-river tc-static-story-river">
<p><div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists  tc-tagged-System tc-tagged-Formal tc-tagged-PL tc-tagged-Paper" data-tags="System Formal PL Paper" data-tiddler-title="Using Lightweight Formal Methods to Validate a Key-Value Storage Node in Amazon S3" role="article"><div class="tc-tiddler-title"><div class="tc-titlebar"><span class="tc-tiddler-controls"><button aria-expanded="false" aria-label="more" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fmore-tiddler-actions" title="More actions"></button><div class=" tc-reveal" hidden="true"></div><button aria-label="edit" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fedit" title="Edit this tiddler"></button><button aria-label="close" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fclose" title="Close this tiddler"></button></span><span><h2 class="tc-title">Using Lightweight Formal Methods to Validate a Key-Value Storage Node in Amazon S3</h2></span></div><div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div></div><div class="tc-reveal"></div><div class=" tc-reveal"><div class="tc-subtitle"><a class="tc-tiddlylink tc-tiddlylink-missing" href=".html"></a> January 21, 2022 at 6:09 pm</div></div><div class=" tc-reveal"><div class="tc-tags-wrapper"><span class="tc-tag-list-item" data-tag-title="Formal"><span aria-expanded="false" class="tc-tag-label tc-btn-invisible" draggable="true" style="fill:rgb(38, 38, 38);color:rgb(38, 38, 38);">Formal</span><span class="tc-drop-down tc-reveal" hidden="true"></span></span><span class="tc-tag-list-item" data-tag-title="Paper"><span aria-expanded="false" class="tc-tag-label tc-btn-invisible" draggable="true" style="fill:rgb(38, 38, 38);color:rgb(38, 38, 38);">Paper</span><span class="tc-drop-down tc-reveal" hidden="true"></span></span><span class="tc-tag-list-item" data-tag-title="PL"><span aria-expanded="false" class="tc-tag-label tc-btn-invisible" draggable="true" style="fill:rgb(38, 38, 38);color:rgb(38, 38, 38);">PL</span><span class="tc-drop-down tc-reveal" hidden="true"></span></span><span class="tc-tag-list-item" data-tag-title="System"><span aria-expanded="false" class="tc-tag-label tc-btn-invisible" draggable="true" style="fill:rgb(38, 38, 38);color:rgb(38, 38, 38);">System</span><span class="tc-drop-down tc-reveal" hidden="true"></span></span></div></div><div class="tc-tiddler-body tc-reveal"><h1 class="">Abstract</h1><p>This paper reports our experience applying lightweight formal methods to validate the correctness of ShardStore, a new key-value storage node implementation for the Amazon S3 cloud object storage service. By “lightweight formal methods" we mean a pragmatic approach to verifying the correctness of a production storage node that is under ongoing feature development by a full-time engineering team. We do not aim to achieve full formal verification, but instead emphasize automation, usability, and the ability to continually ensure correctness as both software and its specification evolve over time. Our approach decomposes correctness into independent properties, each checked by the most appropriate tool, and develops executable reference models as specifications to be checked against the implementation. Our work has prevented 16 issues from reaching production, including subtle crash consistency and concurrency problems, and has been extended by non-formal-methods experts to check new features and properties as ShardStore has evolved.</p><h1 class="">Summary</h1><p>This paper explains the experience of verifying ShardStore, a KV DB implemented in Rust on Amazon S3.
They first introduces what's ShardStore, and then describe their goals and the anatomy of their tasks. There are 3 major parts for validation:</p><ol><li>Correctness</li><li>Crash Consistency</li><li>Concurrent Execution</li></ol><p>Correctness refers to the functionalities should not deviate from the specification. So they build a reference model alone with source code in Rust and launch conformance checking on the model. When testing, they can further use the mock model in memory and avoid using low-speed disks for performance. </p><p>For crash consistency, they want to verify persistence(operations should be consistent if they are persisted before a crash) and forward progress(grace shutdown implies the operations are persisted). They use a dependency graph to depict the interdependencies of operations and such <code>Dependency</code> type can also be passed by the operations. By adding <code>DirtyReboot</code> to the aforementioned model, they can check this property.</p><p>Finally for potential race conditions. they developed their own tool called Shuttle, since current tools cannot scale up. Their tool recruits random algorithm for model checking.</p><p>However, there are still some properties relying on <strong>unsafe</strong> Rust and cannot be covered by the tools. So they use the Rust interpreter validate these parts. And for some security-critical components, they also utilize a formal verifier.</p><p>It turns out that they found several problems, and more potential problems are eliminated before code review.</p><h1 class="">Comments</h1><p>This paper is really well-written. However, I don't think there is something pretty novel in the traditional way and I'm surprised this is the best paper in the System top conference. It's more like to share readers their methodology and experiences of tuning a huge system. However, I do believe the way they present solved a real-world problem in a lightweight manner, which is really valuable. </p><p>Besides, I think the concept, <strong>Continuous Validation</strong>, is interesting. Although their method is not formal enough, they can build a system which allow the engineers without formal verification background to amend the specification(expected) model when contributing code for new functionalities, and therefore permits <strong>verifiability</strong> in the future.</p><h1 class="">Related Artifacts</h1><ul><li><a class="tc-tiddlylink-external" href="https://github.com/p-org/P" rel="noopener noreferrer" target="_blank">P </a></li><li><a class="tc-tiddlylink-external" href="https://github.com/awslabs/shuttle" rel="noopener noreferrer" target="_blank">shuttle </a></li><li><a class="tc-tiddlylink-external" href="https://github.com/viperproject/prusti-dev" rel="noopener noreferrer" target="_blank">Prusti </a></li><li><a class="tc-tiddlylink-external" href="https://github.com/pandaman64/sabi" rel="noopener noreferrer" target="_blank">sabi </a></li><li><a class="tc-tiddlylink-external" href="https://github.com/facebookexperimental/MIRAI" rel="noopener noreferrer" target="_blank">MIRAI </a></li><li><a class="tc-tiddlylink-external" href="https://crux.galois.com/" rel="noopener noreferrer" target="_blank">Crux </a></li><li><a class="tc-tiddlylink-external" href="https://github.com/rust-lang/miri" rel="noopener noreferrer" target="_blank">MIRI </a></li></ul></div>
</div></p>
</section>
</body>
</html>

